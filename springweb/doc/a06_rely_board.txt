# 답변형 게시판
1. 개요
	답변형 게시판은 사용자가 특정 게시물을 올리고 그에 대한 답변을 주고 받을 수 있는 플랫폼입니다.
	이를 위해 사용자는 특정 게시물이나 질문을 제출하고, 이에 대하여 다른 사용자 및 관리자는
	질문에 답변을 할 수 있게 처리하여야 합니다. 또한 부가적인 기능으로 페이징 처리, 첨부파일 업로드
	및 게시물 자료 다운로드, 세션에 따른 수정/삭제 권한 처리 등이 처리할 수 있습니다.
2. 주요 기능
	1) 질문 및 답변 기능
		- 사용자는 질문이나 게시물을 올리고 제출할 수 있어야 합니다.
		- 다른 사용 또는 관리자는 해당 게시물에 대한 언급 또는 답글을 작성하고, 이를 사용자에게 제공할 수 있어야 합니다.
		- 답변을 일반적으로 시간 순서대로 정렬되어야 합니다.
	2) 페이징 처리
		- 많은 양의 게시물과 질문/답변을 효율적으로 관리하기 위해서는 DB 기반의 페이징 처리가 필요합니다.
		- 한 페이지에 보여줄 항목 수를 설정하고, 해당 항목 수도 선택에 의해 변경이 가능하면 사용자가 페이지를 넘기며
			모든 질문과 답변을 탐색할 수 있어야 합니다.
	3) 첨부 파일 업로드
		- 사용자에게 질문이나 답변한 내용에 필요한 자료를 첨부 할 수 있어야 합니다.
		- 이미지, 문서 등 다양한 형식의 파일을 업로드하고 관리해야 합니다.
	4) 권한 관리(세션 처리에 의한)
		- 사용자를 로그인을 특정한 세션 시간 범위 안에 하여, 해당 세션 시간이 지나거나 초기에는 반드시 로그인 하여야 합니다.
		- 로그인을 통하여 지정한 권한이 있으면 그 권한에 따라 게시물에 대한 접근을 처리하여야 합니다.
			ex) 예시 게시판은 해당 세션아이디로만 작성자가 처리되면, 해당 작성자만이 게시물을 수정/삭제할 수 있게 처리하였습니다.
			추가적으로 첨부파일이나 읽기 등에 대하여도 권한에 따른 처리가 session 정보를 통하여 가능합니다.
4. 처리할 파일
	0) 공통 설정
		- 파일 업로드 경로
		
	1) backend(자바단)
		web.com.springweb.a09_board 패키지 밑에 아래 파일 설정..
		
		a09_board.A01_BoardController.java
		a09_board.A02_BoardService.java
		a09_board.A03_BoardDao.java
		a09_board.Board.java   리스트를 위한 DTO
		a09_board.BoardSch.java 페이징 처리 및 검색을 위한 DTO
		a09_board.FileDto.java 파일정보관리를 위한 DTO
		
	2> frontend(jsp)
		src/main/webapp/WEB-INF/views 폴더 하위에..
	
		/views/a09_board/a00_login.jsp  로그인 처리를 위한 view
		/views/a09_board/a01_boardList.jsp 초기 게시물 리스트 화면
		/views/a09_board/a02_boardInsert.jsp 게시물 등록 및 답글 화면
		/views/a09_board/a03_boardDetail.jsp 게시물 상세 화면
		
5. 프로세스에 대한 이해(처리되는 파일과 data 확인)
	1) 전반적인 흐름//관리 데이터
	    # 초기 로그인
		[A01_BoardController]초기화면 /boardList 로 호출하면, 리스트 화면[a01_boardList.jsp] 세션이 없으면 
		로그인 하세요 하면서 /login으로 로그인 화면[a00_login.jsp]이 호출 된다.
		로그인화면(/login) : id, pwd 아이디와 패스워드를 입력해서 해당 데이터가 저장되어 있는지 여부 확인 ==> id, pwd 있는 테이블 필요
		정상로그인했을 때 리스트 화면으로 가서(/boardList) DB데이터 ==> 세션 데이터(jsp session 범위 관리 ${mem.id}) 기준으로
			로그인 여부를 확인하는 DB 안 이름 표현 ${mem.name}  
			==> ## DB 데이터 member(id, pwd, name) 
		# 리스트 화면	
		/boardList로 리스트화면([a01_boardList.jsp])이 출력되는 데, 검색할 내용(제목-subject), 작성자-writer)
			리스트된 데이터(번호-no, 제목-subject, 작성자-writer, 작성일-regdte, 조회수-readcnt)로 확인 할수 있다.
		# 등록 화면	
		등록 버튼 클릭시, 등록할 화면(/boardInsert - [a02_boardInsert.jsp])데이터 나타난다.	등록할 데이터로
		제목-subject, 작성자-writer, 내용 - content, 첨부파일 - 파일명 - fname 선택 등록을 처리한다.
		==> ## DB 데이터 board(no, subject, writer, regdte, readcnt, content) 
		               boardfile(no, fname) 위 게시물 번호와 연관된 no, 파일명 저장공간이 필요..
		# 상세화면 
		리스트된 데이터 중에 한 행을 클릭하면 상세화면으로 이동(/boarDetail [a03_boardDetail.jsp]   
		하나의 행단위 데이터에 실제 저장된 항목 위 DB 데이터 board에서 추가적으로 상위글번호(refno), 수정(uptdte)가 
		처리되는 것을 확인 할 수 있다.
		==> ## DB 데이터 board(no, refno, subject, writer, regdte, uptdte, readcnt, content) 	
		상세글 클릭시 readcnt가 하나씩 증가하여 수정된다.
		수정할 때(/boardUpdate) 처리되고, 제목-subject, 내용-content, 수정일 - uptdte)
		답글달기를 하면 등록화면으로 전환되면서 제목 - subject RE: 붙어서 처리, 내용 - content 이전글 내용 포함되어 처리되고,
			답글 달기 전의 고유번호인 no ==> refno로 hidden되어 있고, 해당 글을 등록 시, 답글로 처리가 된다.
		# 계층형 리스트 데이터
			oracle 계층형 sql 구문에 의해서 상위글 다음에 하위글이 처리되어 출력되게 설정..
		# 페이지 처리 데이터
			프로그램 알고리즘에 의해서 각 화면에 로딩할 갯수 지정(DTO 페이지사이즈-  DBX), 각 페이지 클릭시 해당 페이지 리스트
			출력(DTO 시작번호 마지막번호를 기준으로 DB를 검색하여 로딩한ㄷ).
	
	2) 관리할 데이터에 대한 이해..
		member(id, pwd, name) 부가적으로 auth(권한), point(포인트)
		board(no, refno, subject, writer, regdte, uptdte, readcnt, content) 	
		boardfile(no, fname ) 부가적으로 regdte, uptdte, etc(기타)
		
		no 고유번호를 입력시 필요한 sequence board_seq 필요..
		DROP TABLE BOARD CASCADE CONSTRAINTS;
		create table board(
			no number primary key,
			refno number,
			subject varchar2(100),
			content varchar2(1000),
			writer varchar2(50),
			readcnt number,
			regdte date,
			uptdte date
		);
		create table boardfile(
			no number,
			fname varchar2(100),
			etc varchar2(500),
			regdte date,
			uptdte date
		);
		create sequence board_seq;
		-- 샘플 데이터
		insert into board values(board_seq.nextval,0,'첫번째글','내용없음','himan',0,sysdate, sysdate);
		commit;
6. 데이터베이스 처리..
	1) 조회리스트(기본)
		SELECT * FROM BOARD WHERE WRITER LIKE '%%' AND SUBJECT LIKE '%%'
		작성자와 제목을 키워드 검색으로 처리할 수 있다.
	2) 등록(기본)
	3) 상세(기본)
	4) 수정/삭제
	5) 답글등록
	6) 계층형조회리스트
	7) 파일업로드와 함께 등록
	8) 페이징 처리 리스트

7. 처리한 프로그램에 대한 핵심 코드 개념 이해
	1) spring MVC 패턴
		- 스프링이 돌아가는 프로세스
			컨테이너라는 메모리 공간에 class로 선언하여 특정 범위 web.com.springweb
			안에 있고, annotation으로 @Controller, @Service, @Mapper 선언되면
			객체가 생성되어 서로 간에 관계로 메모리가 설정되어 처리된다.
			이 때, 클래스는 class Person ==> person로 id로 식별하기에 모든 클래스는 다른 클래스명이나
			@Controller("ctrl") 로 변경된 id로 설정하지 않으면 일단, 에러 발생한다.
			
			ex) 
			Annotation-specified bean name 'a01_BoardController' for bean 
			class [web.com.springweb.z04_exp.A01_BoardController] conflicts with existing, 
			non-compatible bean definition of same name and class
			 [web.com.springweb.a09_board.A01_BoardController]
			==> @Controller("boardCtrl01")
			
		- 스프링 클래스 만들 때, 주의 할 점
			클래스명을 동일하게 하는 것을 지양하고, 혹시 에러가 나명 @Controller("이름") 이름 변경 처리.
			@Controller, @Service, @Mapper  어노테이션 에러가 없는지 확인.. 일반 없으면 호출 처리가 안된다.
			@Controller 
				No static resource boardList.
				org.springframework.web.servlet.resource.NoResourceFoundException: No static resource boardList.
				controller에 어노테이션 에러가 없을 때..
			@Service, @Mapper를 설정하지 않는 경우
				java.lang.NullPointerException: Cannot invoke 
				"web.com.springweb.a09_board.A02_BoardService.call()" because 
				"this.service" is null
				
		- controller, view 호출
				JSP file [/WEB-INF/views/a09_board/a01_boardList.jsp.jsp] not found
				controller 마지막에 view단을 호출할 때, 해당 파일없을 때 (오타 확인)
				
		- controller, service, dao, view 호출 처리 순서
			화면브라우저에서 http://localhost:5050/boardList 호출하면
			MVC 개발 패턴  
				url 입력시 호출(요청값 전달 - 매개변수 형식)
				Controller ==> Service ==> Dao	
				Controller <== Service <== Dao	 결과값을  리턴값
					Model 데이터를 addAttribute("key", service결과 리턴값);
				==> view(jsp)에 전송..
					${key}로 화면에 확인..	
				
		
		
		- 각 파일별로 기능 메서드 구조에 대한 이해..(controller, service, dao)
		- dao mapper에서 사용되는 #{변수}, jsp에서 사용되는 ${변수}
		
	2) URL 호출과 메서드 요청값 처리/요청값 객체처리
		- url 별 메서드 만들기 및 주의 할점  : 다른 컨트롤러에서 중복된 url 호출시 에러가 발생한다.
			eb.com.springweb.a09_board.A01_BoardController#boardList2()
			to {GET [/boardList]}: There is already 'a01_BoardController' bean method
			web.com.springweb.a09_board.A01_BoardController#boardList() mapped.
			==> 
			@GetMapping("boardList777")  변경 처리
			public String boardList2() {
		
		- 요청값 처리 단계별 내용(단일 데이터, 요청 객체 처리)
			get방식으로 요청  
				요청 처리  /boardList?subject=공지사항    <input name="subject" value="공지사항">
				서버단
					@GetMapping("boardList")
					public String boardList(@RequestParam("subject") String subject)
			post 요청객체 처리.
				요청 처리 /boardInsert
						요청 body      <form method="post" 
										<input name="subject" value="등록합니다">
										<input name="writer" value="홍길동">
										<input name="content" value="게시물등록">
						subject=등록합니다&writer=홍길동&content=게시물등록
				서버단
					@PostMapping("boardInsert")
					public String boardInsert(Board ins)
						setSubject(String String)				
						setWriter(String String)				
						setContent(String String)				
		
	3) 모델 처리
		- 단일 모델 데이터
			public String getBoard(Model d){
				d.addAttribute("cnt", 5); ==> 단일  모델 데이터 설정..
			}
			==> jsp 단에서   ${cnt}
		
			public String getBoard(Model d){
				d.addAttribute("board", new Board("홍길동", "첫번째게시물")); ==> 객체로 모델 데이터 설정..
			}
			==> jsp단에서  ${board.writer} ${board.subject}
			
		- 리스트형 데이터 
				d.addAttribute("boardList", service.getBoardList(sch)); 
					Dao단에서 조회로 여러 행의 데이터를 가져온 List<Board> 형태 데이터를 모델 데이터로 설정한 경..
			==> jsp단에서..
				<c:forEach var="board" items="${boardList}">
					<tr><td>${board.no}</td><td>${board.subeject}</td><td>${board.readCount}</td>
		
	5) 화면단 처리 
		- 요청 form 처리시 주의 사항
		- el 태그 종료 사용 시, 주의 사항.
		- javascript 사용 코드..
			submit 속성,  .submit() 기능 처리.
			
	6) 파일 업로드 처리 

8. 단계별 개발 순서
	1) 기본 정보 출력 리스트
	2) 기본 정보 등록
	3) 기본 정보 상세
	4) 기본 정보 수정/삭제
	5) 등록시 첨부 파일 처리
	6) 상세화면에 첨부된 파일 다운로드
	7) 세션(권한)처리에 대한 이해와 세션처리.
	8) 답글 달기
	9) 답글에 따른 계층형 sql 처리
	10) 페이지 처리에 대한 알고리즘 이해와 처리
	

# 기본 정보 출력 리스트	
1. 개발 순서
	1) sql 처리 확인
	2) dao 처리
	3) service  처리 
		키워드 검색을 위한 null ==> "",  "데이터" ==> "%데이터%"
	4) controller 처리.
		요청 /boardList
			boardList(Board sch){
				d.addAttribute("boardList", service.boardList(sch));
				
			}
	5) jsp 처리
	private int no;
	private int refno;
	private String subject;
	private String content;
	private String writer;
	private int readcnt;
	private Date regdte;
	private Date uptdte;	
	
		form 
			요청값
			제목:[  ]   name="subject"
			작성자:[    ]   name="subject" 
		==> Board sch	
			
	
		SELECT * FROM BOARD "
			+ "WHERE WRITER LIKE #{writer} "
			+ "AND SUBJECT LIKE #{subject} 
			
		테이블 리스트 처리.
			<c:forEach var="board" items="${boardList}"
			번호   제목   작성자  작성일  조회수

# 2) 기본 정보 등록
1. 처리순서
	초기화면 로딩 @RequestMapping("boardInsert")
				a09_board\a02_boardInsert.jsp	
				

	리스트화면에서 등록 버튼 클릭시,
	아래 등록 화면 로딩..

	
	--------------------------------	

	sql
		
	dao
	service
	controller
		- 등록 form 화면
		- 등록 처리 프로세스
	view
		입력형태의 form으로 화면 로딩..
					
				









			
			
			
